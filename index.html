<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<style>
    .vdp-datepicker__calendar .cell.highlighted {
        background: #4bd;
    }
</style>
<div id="app">
    <eddbk-wizard></eddbk-wizard>
</div>
<script type="text/x-template" id="eddbk-wizard-template">
    <div class="edd-booking-wizard">
        <form-wizard :title="_('Book an Appointment')"
                     subtitle=""
                     :nextButtonText="_('Next')"
                     :backButtonText="_('Back')"
                     :finishButtonText="_('Finish')"
        >
            <tab-content :before-change="canSwitchFromServiceTab">
                <service-step v-model="service"></service-step>
            </tab-content>
            <tab-content :before-change="canSwitchFromSessionTab">
                <session-step v-model="session" :service="service"></session-step>
            </tab-content>
            <tab-content>
                <h1>{{ notes }}</h1>
                <confirmation-step v-model="notes" :service="service" :session="session"></confirmation-step>
            </tab-content>

            <template slot="footer" scope="{activeTabIndex, prevTab, isLastStep, nextTab, fillButtonStyle}">
                <div class="wizard-footer-left" v-if="service && activeTabIndex === 0">
                    <div>{{ serviceInfo.pricePreview }}</div>
                    <div style="opacity: .6" v-if="serviceInfo.isOtherSessionsAvailable">
                    {{ _('More appointment durations available in the next step.') }}
                    </div>
                </div>

                <!--<div class="wizard-footer-clear" style="color: red" v-if="errorMessage">-->
                <!--{{ errorMessage }}-->
                <!--</div>-->

                <div class="wizard-footer-right">
                    <!--&& !props.isLastStep-->
                    <wizard-button v-if="activeTabIndex > 0"
                                   @click.native="prevTab()"
                                   class="wizard-footer-back"
                                   :style="fillButtonStyle">
                        {{ _('Back') }}
                    </wizard-button>

                    <wizard-button @click.native="isLastStep ? createBooking() : nextTab()"
                                   :class="['wizard-footer-right', isLastStep ? 'finish-button' : '']"
                                   :style="fillButtonStyle"
                                   :disabled="isCreatingBooking ? 'disabled' : false"
                    >{{ isLastStep ? _('Book Now') : _('Next') }}</wizard-button>
                </div>
            </template>
        </form-wizard>
    </div>
</script>
<script type="text/x-template" id="eddbk-confirmation-step-template">
<div v-if="service && appointment">
    <div class="service-info">
        <p v-html="_('You are booking: <strong>%(service)s</strong> - %(duration)s appointment', appointment)"></p>
        <p v-html="_('Starting at <strong>%(start)s</strong>', appointment)"></p>
        <p v-html="_('The price is of <strong>%(price)s</strong>', appointment)"></p>
    </div>

    <div class="inline-form-control">
        <label>{{ _('Additional notes') }}</label>
        <textarea
            rows="4"
            v-model="valueProxy"
            class="eddb-control"
            :placeholder="_('Have you got any special requests for the service provider? If yes, please note them down here')"
        ></textarea>
    </div>
</div>
</script>
<script type="text/x-template" id="eddbk-session-step-template">
<div v-if="service">
    <div class="edd-booking-wizard__info">
        {{ _('You are booking a ') }} <strong>{{ service.name }}</strong>
    </div>
    <service-session-selector :service="service" v-model="valueProxy"></service-session-selector>
</div>
</script>
<script type="text/x-template" id="eddbk-service-step-template">
    <div>
        <div class="inline-form-control">
            <label>
                {{ _('Select a service') }}
                <span class="eddbk-loading-inline" v-if="isLoading" style="margin-left: 3px"></span>
            </label>
            <select v-model="valueProxy" class="eddb-control" :disabled="isLoading ? 'disabled' : false">
                <option :value="null" disabled selected>{{ _('Select option') }}</option>
                <option :value="item" v-for="item in services">{{ item.name }}</option>
            </select>
        </div>
        <div class="service">
            <div v-if="value" class="service__image">
                <img :src="value.imageSrc" alt="">
            </div>
            <div v-if="value" class="service__description">
                {{ value.description }}
            </div>
        </div>
    </div>
</script>

<script type="text/x-template" id="service-session-selector-template">
    <div>
        <div>value: <code>{{ value }}</code></div>

        <template v-if="!service">
            <div class="description">Please select service to choose available session for booking.</div>
        </template>
        <template v-else>
            <div v-if="isSessionsLoading">
                <h1>LOADING...</h1>
            </div>
            <div>
                <div><code>selected session duration: {{ sessionDuration }}</code></div>
                <session-duration-picker
                        v-model="sessionDuration"
                        :service="service"
                ></session-duration-picker>
            </div>
            <div>
                <session-date-picker
                        v-model="selectedDaySessions"
                        :is-daily-duration="isDailyDuration"
                        :selected-day.sync="selectedDay"
                        :session.sync="session"
                        :loading="isSessionsLoading"
                        :selected-session-length="sessionDuration"
                        :available-sessions="sessions"
                        :prev-available-day.sync="prevAvailableDay"
                        :next-available-day.sync="nextAvailableDay"
                        @changedMonth="loadSessions"
                ></session-date-picker>
            </div>
            <div v-if="!isDailyDuration">
                <session-time-picker v-model="session"
                                     :selected-day.sync="selectedDay"
                                     :selected-session-length="sessionDuration"
                                     :service="service"
                                     :timezone="timezone"
                                     :sessions="selectedDaySessions"
                                     :prev-available-day="prevAvailableDay"
                                     :next-available-day="nextAvailableDay"
                ></session-time-picker>
                selectedSessionLabel: {{ selectedSessionLabel }}
            </div>
        </template>
    </div>
</script>
<script type="text/x-template" id="session-date-picker-template">
    <div class="form-row">
        <div><code>selected day in date: {{ selectedDay }}</code></div>
        <div class="form-row__label form-row__label--smaller">
            Month
            <span class="loading-inline" v-if="loading"></span>
        </div>
        <div class="form-row__input exclusions-datepicker">
            <datepicker v-model="selectedDayProxy"
                        :inline="true"
                        @changedMonth="onMonthChange"
                        :open-date="openedOnDate"
                        :disabled="{ customPredictor: isDateDisabled, to: today }"
                        :highlighted="{ dates: sessionDays, includeDisabled: true }"
                        class="sessions-datepicker"
                        maximum-view="day"
            ></datepicker>
        </div>
    </div>
</script>
<script type="text/x-template" id="session-time-picker-template">
    <div>
        <div class="form-row">
            <div class="form-row__label form-row__label--smaller">Session</div>
            <div class="form-row__input">
                <div class="session-picker">
                    <div class="session-picker-header">
                        <button :disabled="prevAvailableDay ? false : 'disabled'" @click="goToPrevDay">Prev</button>
                        <span>{{ selectedDaySessionsLabel }}</span>
                        <button :disabled="nextAvailableDay ? false : 'disabled'" @click="goToNextDay">Next</button>
                    </div>
                    <div class="session-picker-buttons">
                        <div v-for="session in visibleSessions"
                             @click="select(session)"
                             :class="['session-picker-button', isSelected(session) ? 'session-picker-button--selected' : '']"
                        >
                            {{ sessionLabel(session) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>
<script type="text/x-template" id="session-duration-picker-template">
    <div class="form-row">
        <div class="form-row__label form-row__label--smaller">Duration</div>
        <div class="form-row__input">
            <select v-model="valueProxy" style="width: 100%">
                <option :value="sessionLength" v-for="sessionLength in service.sessionLengths">
                    {{ sessionLengthLabel(sessionLength) }}
                </option>
            </select>
        </div>
    </div>
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // get default configuration inside the Bottle instance
    require.config({
      paths: {
        cjs: 'https://rawgit.com/guybedford/cjs/master/cjs',
        'amd-loader': 'https://rawgit.com/guybedford/amd-loader/master/amd-loader',
        stdLib: 'https://unpkg.com/@rebelcode/std-lib@0.1.4/dist/std-lib.umd',
        bottle: 'https://cdnjs.cloudflare.com/ajax/libs/bottlejs/1.6.1/bottle.min',
        vue: 'https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.4/vue',
        bookingWizardComponents: '/dist/js/bwc.min',
        formWizard: 'https://unpkg.com/vue-form-wizard/dist/vue-form-wizard',
        axios: 'https://cdn.jsdelivr.net/npm/axios@0.18.0/dist/axios.min',
        humanizeDuration: 'https://cdnjs.cloudflare.com/ajax/libs/humanize-duration/3.14.0/humanize-duration.min',
        uiFramework: 'https://unpkg.com/@rebelcode/ui-framework@0.1.1/dist/static/js/uiFramework',
        datepicker: 'https://cdn.jsdelivr.net/npm/vuejs-datepicker@0.9.26/dist/build.min',
        lodash: 'https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min',
        textFormatter: 'https://unpkg.com/sprintf-js@1.1.1/dist/sprintf.min',
        moment: 'https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min',
        momentTimezone: 'https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.17/moment-timezone-with-data-2012-2022.min',
        momentRange: 'https://cdnjs.cloudflare.com/ajax/libs/moment-range/4.0.1/moment-range',
      }
    })

    var dependenciesList = ['formWizard', 'textFormatter', 'bookingWizard', 'bookingWizardComponents', 'uiFramework', 'bottle', 'vue', 'axios', 'humanizeDuration', 'cjs!datepicker',
      'moment', 'momentTimezone', 'lodash', 'cjs!momentRange', 'stdLib']

    function defineServices (di, dependencies) {
      console.info(dependencies)
      var serviceList = dependencies.bookingWizard.services(dependencies, document)
      for (var i = 0; i < Object.keys(serviceList).length; i++) {
        var serviceName = Object.keys(serviceList)[i]
        di.factory(serviceName, serviceList[serviceName])
      }

      di.factory('config', function () {
        return {
          endpoints: {
            sessions: {
              'fetch': {
                'method': 'get',
                'endpoint': 'http://scotchbox.local/index.php?rest_route=/eddbk/v1/sessions/',
              }
            }
          },
          bookingsResourceUrl: 'http://scotchbox.local/index.php?rest_route=/eddbk/v1/bookings/',
          initialBookingTransition: 'cart',
          servicesResourceUrl: 'http://scotchbox.local/index.php?rest_route=/eddbk/v1/services/',
          datetime: {
            'tzFree': 'YYYY-MM-DD HH:mm:ss',
            'store': 'YYYY-MM-DDTHH:mm:ssZ',
            'sessionTime': 'h:mm a',
            'dayFull': 'dddd Do MMMM YYYY',
            'dayShort': 'D MMMM YYYY',
            'monthKey': 'YYYY-MM',
            'dayKey': 'YYYY-MM-DD',
            'appointmentStart': 'h:mm a \o\\n dddd Do MMMM YYYY'
          }
        }
      })
      di.factory('document', function () {
        return document
      })
      di.factory('selectorList', function () {
        return [
          '#app',
        ]
      })
    }
    require(dependenciesList, function () {
      var dependencies = {}
      for (var i = 0; i < dependenciesList.length; i++) {
        dependencies[dependenciesList[i].replace('cjs!', '')] = arguments[i]
      }
      var di = new dependencies.bottle()

      defineServices(di, dependencies)
      var container = new dependencies.uiFramework.Container.Container(di)
      var app = new dependencies.uiFramework.Core.App(container)
      app.init()
    })
  })
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.js"></script>
</body>
</html>